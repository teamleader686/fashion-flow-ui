# ðŸ“¦ Full-Stack Storage Monitoring System

This project now includes a comprehensive storage monitoring system that tracks Supabase Storage (images, assets) and Database usage across the entire application.

## ðŸš€ Features

1.  **Dashboard Analytics**:
    *   **Module-wise Breakdown**: See exactly how much storage Products, Categories, Avatars, etc., are consuming.
    *   **Daily Trends**: Interactive charts showing uploads vs. deletions over the last 30 days.
    *   **Top Consumers**: Identify which specific files or records are using the most space.
    *   **Real-time Alerts**: Warnings at 80% usage, critical alerts at 90%.

2.  **User-Side Features**:
    *   **Profile Storage**: Users can see their own storage usage on the `Edit Profile` page.
    *   **Avatar Upload**: Users can now upload profile pictures, which are automatically tracked.

3.  **Automatic Tracking (CRUD)**:
    *   The system silently logs storage impacts for every create, update, delete, and upload operation:
        *   âœ… Product Creation & Deletion
        *   âœ… Order Creation & Deletion (New!)
        *   âœ… Image Uploads (Products, Categories, Sliders, Avatars)
        *   âœ… Order Placement (tracks order & item data size)
        *   âœ… Category Management

4.  **Reporting**:
    *   **Excel Export**: One-click download of a detailed 4-sheet Excel report containing overview, breakdown, daily logs, and top usage data.

## ðŸ› ï¸ Setup Instructions (Crucial Step)

To enable the analytics features, you **MUST** run the SQL migration script in your Supabase project.

1.  Go to your **Supabase Dashboard** > **SQL Editor**.
2.  Open the file: `database/STORAGE_MONITORING_SYSTEM.sql`
3.  Copy the entire content and paste it into the SQL Editor.
4.  Run the script. This will create:
    *   `storage_logs` table
    *   `user_storage_usage` table
    *   RLS Policies
    *   RPC Functions for analytics (`get_storage_by_module`, `get_daily_storage_usage`, etc.)

> **Note**: Without running this script, the "CRUD Activity Analytics" section on the Storage Monitoring page will be empty.

## ðŸ“‚ Key Files Created/Modified

*   `src/pages/admin/StorageMonitoring.tsx`: The main dashboard page.
*   `src/components/admin/storage/StorageAnalytics.tsx`: New component for charts and detailed tables.
*   `src/lib/storageLogger.ts`: Central utility for logging storage operations.
*   `src/hooks/useStorageStats.ts`: Hook that fetches both bucket sizes and database logs.
*   `src/hooks/useUserStorage.ts`: Hook for fetching per-user storage data.
*   `database/STORAGE_MONITORING_SYSTEM.sql`: The backend logic.

## ðŸ§ª How to Test

1.  **Admin**: Go to `/admin/storage` to see the dashboard.
2.  **Upload**: Create a new product or upload a slider image.
3.  **User**: Go to `Edit Profile`, upload an avatar, and see the "Your Storage Usage" section update.
4.  **Check Logs**: Go back to `/admin/storage` and verify the "CRUD Activity Analytics" section reflects the new upload.

---
*Generated by AntiGravity Agent*
